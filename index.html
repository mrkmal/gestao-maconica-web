<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Principal - Sistema Maçônico</title>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    
    <style>
        /* Estilos de layout e login */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1, h2 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        .menu-button { 
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            background-color: #007bff; color: white; border: none; border-radius: 4px; 
            cursor: pointer; text-align: left; font-size: 1.1em; text-decoration: none;
        }
        .menu-button:hover { background-color: #0056b3; }
        #login-screen { 
            max-width: 400px; margin: 100px auto; padding: 20px; 
            background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
        }
        form input[type="text"], form input[type="password"] { 
            width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; 
            border-radius: 4px; box-sizing: border-box; display: block;
        }
        button { 
            background-color: #007bff; color: white; padding: 10px 15px; 
            border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; 
        }
        /* CORRIGIDO: A aplicação começa escondida, e o JS decide se mostra o login ou o app */
        #app-content { 
            display: none; 
        }
        #login-screen {
             display: none; /* Começa escondido, o JS irá mostrar */
        }
    </style>
</head>
<body>
    <div id="initial-loading" style="text-align: center; margin-top: 50px;">
        <h2>A carregar sistema...</h2>
    </div>

    <div id="login-screen">
        <h2>Acesso ao Sistema Maçônico</h2>
        <p>Use o botão "Criar Nova Conta" APENAS na primeira vez.</p>
        <form id="form-login">
            <label for="login-email">Email:</label>
            <input type="text" id="login-email" required>
            
            <label for="login-password">Senha:</label>
            <input type="password" id="login-password" required>
            
            <button type="button" onclick="fazerLogin()">Entrar</button>
            <button type="button" onclick="criarConta()">Criar Nova Conta</button>
            <p id="login-status" style="color:red; margin-top: 10px;"></p>
        </form>
    </div>

    <div id="app-content">
        
        <button onclick="fazerLogout()" style="float: right; background-color: #333; margin-bottom: 20px;">Sair</button>

        <h1>Menu Principal do Sistema Maçônico</h1>
        
        <div class="container" style="display: block; max-width: 600px; margin: auto;">
            
            <h2>Gestão e Cadastros</h2>
            <a href="javascript:void(0)" onclick="navigateTo('/cad_graus.html')" class="menu-button">Gerir Graus Maçônicos</a>
            <a href="javascript:void(0)" onclick="navigateTo('/cad_irmaos.html')" class="menu-button">Cadastro de Irmãos</a>
            <a href="javascript:void(0)" onclick="navigateTo('/cad_sessoes.html')" class="menu-button">Registo de Sessões e Frequência</a>

            <hr style="margin: 30px 0;">
            
            <h2>Relatórios e Configuração</h2>
            <a href="javascript:void(0)" onclick="navigateTo('/relatorios.html')" class="menu-button">Relatórios de Frequência</a>
            <a href="#" class="menu-button" style="background-color: #ccc; color: #555; cursor: default;">Gestão de Usuários (Próximo Módulo)</a>
        </div> 

    </div> <script>
        /* Documentação JavaScript: Lógica de Autenticação e Menu */
        
        // --- 1. CONFIGURAÇÃO DO FIREBASE (COM OS SEUS DADOS) ---
        const firebaseConfig = {
          apiKey: "AIzaSyCk-L6r_p9SPxx_WmuPnzEMcEAlDfLlbJk",
          authDomain: "gestao-maconica.firebaseapp.com",
          projectId: "gestao-maconica",
          storageBucket: "gestao-maconica.firebasestorage.app",
          messagingSenderId: "57851106083",
          appId: "1:57851106083:web:0572445f0f856d22347296",
          measurementId: "G-F1ZZ7XB7DQ"
        };

        // Inicializa o Firebase e as Referências
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); 

        /* --- 2. GESTÃO DE AUTENTICAÇÃO E NAVEGAÇÃO --- */

        // Esconde o loading e mostra o app
        function mostrarApp() {
            document.getElementById('initial-loading').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            document.getElementById('login-screen').style.display = 'none';
        }

        // Esconde o loading e mostra o login
        function mostrarLogin() {
            document.getElementById('initial-loading').style.display = 'none';
            document.getElementById('app-content').style.display = 'none';
            document.getElementById('login-screen').style.display = 'block';
        }

        // Navegação segura
        function navigateTo(url) {
            if (auth.currentUser) {
                window.location.href = url;
            } else {
                alert('Sessão expirada. Redirecionando para o login.');
                mostrarLogin();
            }
        }
        
        // Criar uma Nova Conta
        function criarConta() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            // ... (Lógica de criar conta) ...
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => { alert('Conta criada com sucesso! Pode iniciar sessão.'); })
                .catch((error) => { alert('Erro ao criar conta: ' + error.message); });
        }
        
        // Fazer Login
        function fazerLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            // ... (Lógica de login) ...
            auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                .then(() => { return auth.signInWithEmailAndPassword(email, password); })
                .then(() => { alert('Login bem-sucedido. Aguardando carregamento da sessão...'); })
                .catch((error) => { alert('Erro no Login: Email ou senha inválidos.'); });
        }
        
        // Fazer Logout
        function fazerLogout() {
            auth.signOut().then(() => { alert('Sessão encerrada.'); }).catch((error) => { console.error('Erro ao fazer logout:', error); });
        }

        // VERIFICAÇÃO PRINCIPAL: Monitorizar o estado da autenticação (Agora lida com a tela de loading)
        auth.onAuthStateChanged((user) => {
            if (user) {
                mostrarApp(); 
            } else {
                mostrarLogin(); 
            }
        });
        
    </script>
</body>
</html>