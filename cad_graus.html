<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Graus Maçônicos</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .section { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        h2 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        form label { display: block; margin: 10px 0 5px; font-weight: bold; }
        form input[type="text"], form input[type="number"] { 
             width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; 
        }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        button.delete { background-color: #dc3545; margin-left: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

    <a href="/index.html" style="text-decoration: none;"><button style="background-color: #555;">← Voltar ao Menu</button></a>
    <div class="section">
        <h2>Gestão de Graus Maçônicos</h2>

        <form id="form-grau">
            <label for="numero-grau">Número/Ordem do Grau:</label>
            <input type="number" id="numero-grau" required min="1" value="1"> 
            
            <label for="nome-grau">Nome do Grau:</label>
            <input type="text" id="nome-grau" required>
            
            <button type="submit">Adicionar Grau</button>
        </form>

        <h3>Graus Cadastrados</h3>
        <table id="tabela-graus">
            <thead>
                <tr><th>Nº</th><th>Nome do Grau</th><th>Ações</th></tr> 
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // --- 1. CONFIGURAÇÃO DO FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyCk-L6r_p9SPxx_WmuPnzEMcEAlDfLlbJk",
          authDomain: "gestao-maconica.firebaseapp.com",
          projectId: "gestao-maconica",
          storageBucket: "gestao-maconica.firebasestorage.app",
          messagingSenderId: "57851106083",
          appId: "1:57851106083:web:0572445f0f856d22347296",
          measurementId: "G-F1ZZ7XB7DQ"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let graus = [];
        
        // --- FUNÇÕES DE GESTÃO DE GRAUS ---

        function carregarGraus() {
            db.collection("graus").orderBy("numero", "asc").onSnapshot((snapshot) => {
                graus = [];
                snapshot.forEach((doc) => {
                    graus.push({ id: doc.id, ...doc.data() });
                });
                exibirGraus();
            });
        }

        function exibirGraus() {
            const tbody = document.getElementById('tabela-graus').getElementsByTagName('tbody')[0];
            tbody.innerHTML = ''; 
            graus.forEach(g => {
                const row = tbody.insertRow();
                row.insertCell().textContent = g.numero; 
                row.insertCell().textContent = g.nome;
                const cellAcoes = row.insertCell(); 
                const btnExcluir = document.createElement('button');
                btnExcluir.textContent = 'Excluir';
                btnExcluir.style.backgroundColor = '#dc3545';
                btnExcluir.onclick = () => excluirGrau(g.id, g.nome);
                cellAcoes.appendChild(btnExcluir);
            });
        }
        
        document.getElementById('form-grau').addEventListener('submit', function(e) {
            e.preventDefault();
            const nome = document.getElementById('nome-grau').value.trim();
            const numero = parseInt(document.getElementById('numero-grau').value, 10); 
            db.collection("graus").add({ nome: nome, numero: numero }) 
                .then(() => { alert(`Grau ${numero} - "${nome}" cadastrado!`); this.reset(); })
                .catch((error) => { alert("Erro ao salvar o Grau. Verifique as regras!"); console.error(error); });
        });

        function excluirGrau(grauId, nomeGrau) {
            if (!confirm(`Excluir o Grau "${nomeGrau}"?`)) return;
            db.collection("graus").doc(grauId).delete()
                .then(() => { alert(`Grau "${nomeGrau}" excluído!`); })
                .catch((error) => { alert(`Erro ao tentar excluir!`); console.error(error); });
        }
        
        // --- 4. CHECAGEM DE AUTENTICAÇÃO ---
        
        auth.onAuthStateChanged((user) => {
            if (user) {
                carregarGraus();
            } else {
                window.location.href = "/index.html"; // Redireciona para o login
            }
        });

    </script>
</body>
</html>